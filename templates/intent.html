<!DOCTYPE html>
<html>
<head>
    <title>Intent</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
</head>
<style>
    body a{
        text-decoration: none;
        
    }
    body{
        background-color: #0d6efd;
        font-size: 20px;
    }
    body h1{
        text-align:center;
    }
    ul{ 
       
        list-style-type: none;
    }
    
    .cauhoi{
        display:flex;

    }
    .cauhoi p{
       margin-right:20px;
        
    }

   
    li a:hover{
        transition: 0.5s;
    }
    .center-button {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 10vh;
    }
    .form-container {
      display: flex;
      align-items: center;
    }
    .form-container .form-control {
      margin-right: 10px; 
    }
    .form-container form {
      margin-right: 10px; 
    }
    .quayve {
        color:white;  
    }
    .btn btn-primary{
        margin-left: auto;
        margin-right: auto;
    }
    
</style>
<body>
{% if data %}
    {%if data[0][4]%}
    <div class="text-bg-primary">
        <h1 class="display-" >{{ data[0][3] }}</h1>
    </div>
    <ul class="list-group">
        {% for record in data %}
        <li class="list-group-item">
          <div class="form-container">
            <div class="form-control">
              <label class="control-label col-sm-12">Ngành: {{ record[4] }}</label>
              <label class="control-label col-sm-12">Câu trả lời: {{ record[1] }}</label>
            </div>
            <div class="d-flex">
              <!-- Modal Xác nhận Xóa -->
              <div class="modal fade" id="confirmDeleteModal{{ record[2] }}" tabindex="-1" role="dialog" aria-labelledby="confirmDeleteModalLabel{{ record[2] }}" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="confirmDeleteModalLabel{{ record[2] }}">Xác nhận xóa</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      Bạn có chắc chắn muốn xóa không?
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                      <form id="deleteForm{{ record[2] }}" action="/intent/{{ intent_name }}/delete" method="POST">
                        <input type="hidden" name="node_id" value="{{ record[2] }}">
                        <button type="button" class="btn btn-danger" onclick="confirmDelete('{{ record[2] }}')">Xác nhận</button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
      
              <!-- Nút Xóa -->
              <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#confirmDeleteModal{{ record[2] }}"><i class="bi bi-trash"></i></button>
      
              <!-- Cập nhật -->
              <button class="btn btn-info" data-bs-toggle="collapse" data-bs-target="#collapseExample{{ record[2] }}" aria-expanded="false" aria-controls="collapseExample"><i class="bi bi-pen"></i></button>
            </div>
          </div>
          <!-- Form cập nhật -->
          <div class="collapse" id="collapseExample{{ record[2] }}">
            <div class="card card-body">
              <form action="/intent/{{ intent_name }}/edit" method="POST">
                <input type="hidden" name="node_id" value="{{ record[2] }}">
                <select name="nganh" class="form-control input-sm">
                  {% for recordnganh in datanganh %}
                    {% if record[4] == recordnganh %}
                      <option value='{{recordnganh}}' selected>{{recordnganh}}</option>
                    {% else %}
                      <option value='{{recordnganh}}'>{{recordnganh}}</option>
                    {% endif %}
                  {% endfor %}
                </select>
                <textarea class="form-control input-sm" rows="5" placeholder="Câu trả lời" name="answer">{{ record[1] }}</textarea>
                <div class="center-button">
                  <button type="submit" class="btn btn-info">Cập nhật</button>
                </div>
              </form>
            </div>
          </div>
        </li>
        {% endfor %}
      </ul>
    {% else %}  
    <div class="text-bg-primary">
        <h1 class="display-2" >{{ data[0][3] }}</h1>
    </div>
    
    <ul class="list-group">
        {% for record in data %}
        <li class="list-group-item">
          <div class="form-container">
            <div class="form-control">
              <label class="control-label col-sm-12">Câu hỏi: {{ record[0] }}</label>
              <label class="control-label col-sm-12">Câu trả lời: {{ record[1] }}</label>
              {% for record_entity in data_entity %}
                {% if record[5] == record_entity[0] %}
                  <label class="control-label col-sm-12">Thực thể:  {{ record_entity[1] }}</label>
                {% endif %}
              {% endfor %}
            </div>
      
            <div class="d-flex">
              <!-- Modal Xác nhận Xóa -->
              <div class="modal fade" id="confirmDeleteModal{{ record[2] }}" tabindex="-1" role="dialog" aria-labelledby="confirmDeleteModalLabel{{ record[2] }}" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="confirmDeleteModalLabel{{ record[2] }}">Xác nhận xóa</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      Bạn có chắc chắn muốn xóa không?
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                      <form id="deleteForm{{ record[2] }}" action="/intent/{{ intent_name }}/delete" method="POST">
                        <input type="hidden" name="node_id" value="{{ record[2] }}">
                        <button type="button" class="btn btn-danger" onclick="confirmDelete('{{ record[2] }}')">Xác nhận</button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
      
              <!-- Nút Xóa -->
              <form action="/intent/{{ intent_name }}/delete" method="POST">
                <input type="hidden" name="node_id" value="{{ record[2] }}">
                <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#confirmDeleteModal{{ record[2] }}"><i class="bi bi-trash"></i></button>
              </form>
      
              <!-- Cập nhật -->
              <button class="btn btn-info" data-bs-toggle="collapse" data-bs-target="#collapseExample{{ record[2] }}" aria-expanded="false" aria-controls="collapseExample"><i class="bi bi-pen"></i></button>
            </div>
            </div>
            <!-- Form cập nhật -->
            <div class="collapse" id="collapseExample{{ record[2] }}">
              <div class="card card-body">
                <form action="/intent/{{ intent_name }}/edit" method="POST">
                  <input type="hidden" name="node_id" value="{{ record[2] }}">
                  <input type="text" name="question" value="{{ record[0] }}" class="form-control input-sm">
                  <textarea class="form-control input-sm" rows="5" placeholder="Câu trả lời" name="answer">{{ record[1] }}</textarea>
                  <select name="entity" class="form-control input-sm">
                    <option value=''>Câu hỏi chung</option>
                    {% for record_entity in data_entity %}
                      <option value='{{record_entity[0]}}' {% if record_entity[0] == record[5] %} selected {% endif %}>{{record_entity[1]}}</option>
                    {% endfor %}
                  </select>
                  <div class="center-button">
                    <button type="submit" class="btn btn-info">Cập nhật</button>
                  </div>
                </form>
              </div>
            </div>
         
        </li>
        {% endfor %}
      </ul>
    {%endif%}
{% else %}
    <p>Không có dữ liệu trong CSDL</p>
{% endif %}

<div class="form-control">
    <form action="/intent/{{ intent_name }}/add" method="POST">
        {%if data[0][4]%}
            <select name="nganh" class="form-select">
                <option value='' disabled selected>Chọn ngành</option>
                    {%for recordnganh in datanganh%}
                    
                        <option value='{{recordnganh}}'>{{recordnganh}}</option>
                    {%endfor%}
                    <textarea class="form-control input-lg" rows="5" placeholder="Câu trả lời" name="answer"></textarea>
            </select>
            {%else%}
            <input type="text" name="question" class="form-control input-sm" placeholder="Câu hỏi">
            <textarea class="form-control input-sm" rows="5" placeholder="Câu trả lời" name="answer"></textarea>
            <select name="entity" class="form-select">
                <option value=''>Câu hỏi chung</option>
                {%for record_entity in data_entity%}
                    <option value='{{record_entity[0]}}'>{{record_entity[1]}}</option>
                {%endfor%}
            </select>   
            {%endif%}
            <div class="center-button">
        <button type="submit" class="btn btn-primary">Thêm</button>
        </div>
    </form>
</div>
<a href="/quanly" class="quayve">Quay về</a>
</body>
</html>
<script>
    function confirmDelete(recordId) {
      document.getElementById("deleteForm" + recordId).submit();
    }
  </script>